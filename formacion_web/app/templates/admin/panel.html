{% extends "base.html" %}

{% block title %}Panel Maestro | GC System{% endblock %}

{% block content %}
<div class="relative min-h-[80vh]">
    <!-- Contenedor principal -->
    <div class="relative z-10 max-w-7xl mx-auto px-4 py-8">
        
        <!-- Header profesional y sobrio -->
        <div class="bg-gradient-to-r from-ink/95 to-ink/90 px-8 py-6 rounded-2xl border-2 border-parchment/30 mb-8 shadow-xl">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-6">
                    <div class="w-14 h-14 bg-gradient-to-br from-hogwarts-gold to-amber-800 rounded-xl flex items-center justify-center border-2 border-parchment shadow-md">
                        <span class="material-symbols-outlined text-2xl text-ink">admin_panel_settings</span>
                    </div>
                    <div>
                        <h1 class="font-heading font-bold text-2xl text-parchment tracking-wide">Panel de Administración</h1>
                        <div class="flex items-center gap-6 mt-2">
                            <span class="font-body text-sm text-parchment/80 flex items-center gap-2">
                                <span class="material-symbols-outlined text-base">person</span>
                                Administrador: {{ session.username }}
                            </span>
                            <span class="font-body text-sm text-parchment/80 flex items-center gap-2">
                                <span class="material-symbols-outlined text-base">psychology</span>
                                Sistema v4.2
                            </span>
                        </div>
                    </div>
                </div>
                
                <div class="text-right">
                    <div class="font-mono font-semibold text-parchment text-base">{{ now }}</div>
                    <div class="mt-2 inline-flex items-center gap-2 bg-parchment/10 border border-parchment/30 px-3 py-1.5 rounded-lg">
                        <span class="w-2 h-2 rounded-full bg-green-500"></span>
                        <span class="font-body text-xs text-parchment font-medium">Activo</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Métricas profesionales -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-5 mb-8">
            <a href="{{ url_for('admin.inicializar_cursos') }}" class="bg-parchment/3 border border-ink/20 rounded-xl p-5 hover:border-gryffindor/40 hover:bg-parchment/5 transition-all duration-200">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-lg bg-gryffindor/10 flex items-center justify-center border border-gryffindor/30">
                            <span class="material-symbols-outlined text-gryffindor text-xl">menu_book</span>
                        </div>
                        <div>
                            <div class="font-body font-medium text-ink/70 text-xs">Gestión</div>
                            <div class="font-heading font-bold text-lg text-ink mt-0.5">Cursos</div>
                        </div>
                    </div>
                    <span class="material-symbols-outlined text-ink/40 text-lg">arrow_forward</span>
                </div>
            </a>
            
            <a href="{{ url_for('admin.registrar_pago') }}" class="bg-parchment/3 border border-ink/20 rounded-xl p-5 hover:border-gryffindor/40 hover:bg-parchment/5 transition-all duration-200">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-lg bg-gryffindor/10 flex items-center justify-center border border-gryffindor/30">
                            <span class="material-symbols-outlined text-gryffindor text-xl">account_balance</span>
                        </div>
                        <div>
                            <div class="font-body font-medium text-ink/70 text-xs">Finanzas</div>
                            <div class="font-heading font-bold text-lg text-ink mt-0.5">Pagos</div>
                        </div>
                    </div>
                    <span class="material-symbols-outlined text-ink/40 text-lg">arrow_forward</span>
                </div>
            </a>
            
            <a href="{{ url_for('admin.exportar_alumnos') }}" class="bg-parchment/3 border border-ink/20 rounded-xl p-5 hover:border-gryffindor/40 hover:bg-parchment/5 transition-all duration-200">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-lg bg-gryffindor/10 flex items-center justify-center border border-gryffindor/30">
                            <span class="material-symbols-outlined text-gryffindor text-xl">groups</span>
                        </div>
                        <div>
                            <div class="font-body font-medium text-ink/70 text-xs">Base de Datos</div>
                            <div class="font-heading font-bold text-lg text-ink mt-0.5">Alumnos</div>
                        </div>
                    </div>
                    <span class="material-symbols-outlined text-ink/40 text-lg">arrow_forward</span>
                </div>
            </a>
            
            <a href="{{ url_for('admin.exportar_profesores') }}" class="bg-parchment/3 border border-ink/20 rounded-xl p-5 hover:border-gryffindor/40 hover:bg-parchment/5 transition-all duration-200">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-lg bg-gryffindor/10 flex items-center justify-center border border-gryffindor/30">
                            <span class="material-symbols-outlined text-gryffindor text-xl">school</span>
                        </div>
                        <div>
                            <div class="font-body font-medium text-ink/70 text-xs">Base de Datos</div>
                            <div class="font-heading font-bold text-lg text-ink mt-0.5">Profesores</div>
                        </div>
                    </div>
                    <span class="material-symbols-outlined text-ink/40 text-lg">arrow_forward</span>
                </div>
            </a>
        </div>

        <!-- Mensajes flash -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="bg-parchment border-l-4 border-gryffindor rounded-lg p-4 mb-6 flex items-center gap-3">
                        <span class="material-symbols-outlined text-gryffindor text-xl">info</span>
                        <span class="font-body font-medium text-ink">{{ message }}</span>
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <!-- Sección: Actividad Docente -->
        <div class="bg-parchment/5 border border-ink/20 rounded-xl p-6 mb-8">
            <div class="flex items-center justify-between mb-5 pb-4 border-b border-ink/20">
                <div class="flex items-center gap-3">
                    <span class="material-symbols-outlined text-ink text-xl">school</span>
                    <h2 class="font-heading font-bold text-lg text-ink">Actividad Docente</h2>
                </div>
                <span class="font-body text-sm text-ink/60">Supervisión</span>
            </div>
            
            {% if profesores_actividad %}
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead>
                            <tr class="border-b border-ink/20">
                                <th class="text-left py-3 px-4 font-body font-bold text-xs text-ink/70 uppercase tracking-wide">Profesor</th>
                                <th class="text-left py-3 px-4 font-body font-bold text-xs text-ink/70 uppercase tracking-wide">Cursos</th>
                                <th class="text-left py-3 px-4 font-body font-bold text-xs text-ink/70 uppercase tracking-wide">Interacciones</th>
                                <th class="text-left py-3 px-4 font-body font-bold text-xs text-ink/70 uppercase tracking-wide">Estado</th>
                                <th class="text-right py-3 px-4 font-body font-bold text-xs text-ink/70 uppercase tracking-wide">Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for item in profesores_actividad %}
                            <tr class="border-b border-ink/10 hover:bg-parchment/10 transition-colors">
                                <td class="py-3 px-4 font-body font-medium text-sm text-ink">{{ item.profesor.username }}</td>
                                <td class="py-3 px-4 font-body text-sm text-ink/70">
                                    {% if item.cursos_impartidos > 0 %}
                                        {{ item.cursos_impartidos }} asignados
                                    {% else %}
                                        Sin cursos
                                    {% endif %}
                                </td>
                                <td class="py-3 px-4 font-body text-sm text-ink/70">{{ item.mensajes }} mensajes</td>
                                <td class="py-3 px-4">
                                    {% if item.cursos_impartidos == 0 and item.total_actividad == 0 %}
                                        <span class="inline-flex items-center gap-1.5 px-2.5 py-1 bg-red-100 border border-red-200 text-red-700 rounded-md font-body text-xs font-medium">
                                            <span class="w-1.5 h-1.5 rounded-full bg-red-500"></span>
                                            Inactivo
                                        </span>
                                    {% elif item.total_actividad > 3 %}
                                        <span class="inline-flex items-center gap-1.5 px-2.5 py-1 bg-green-100 border border-green-200 text-green-700 rounded-md font-body text-xs font-medium">
                                            <span class="w-1.5 h-1.5 rounded-full bg-green-500"></span>
                                            Activo
                                        </span>
                                    {% else %}
                                        <span class="inline-flex items-center gap-1.5 px-2.5 py-1 bg-yellow-100 border border-yellow-200 text-yellow-700 rounded-md font-body text-xs font-medium">
                                            <span class="w-1.5 h-1.5 rounded-full bg-yellow-500"></span>
                                            Baja actividad
                                        </span>
                                    {% endif %}
                                </td>
                                <td class="py-3 px-4 text-right">
                                    <a href="{{ url_for('admin.eliminar_profesor', profesor_id=item.profesor.id) }}" 
                                       onclick="return confirm('¿Confirmar eliminación de registro?')"
                                       class="text-ink/50 hover:text-red-600 hover:bg-red-50 p-1.5 rounded-md transition-colors" title="Eliminar">
                                        <span class="material-symbols-outlined text-base">delete</span>
                                    </a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <div class="py-10 text-center text-ink/50 font-body text-sm">
                    <span class="material-symbols-outlined text-3xl mb-2 block text-ink/20">school</span>
                    No hay profesores registrados
                </div>
            {% endif %}
        </div>

        <!-- Sección: Matrículas y Alumnos -->
        <div class="bg-parchment/5 border border-ink/20 rounded-xl p-6">
            <div class="flex items-center justify-between mb-5 pb-4 border-b border-ink/20">
                <div class="flex items-center gap-3">
                    <span class="material-symbols-outlined text-ink text-xl">groups</span>
                    <h2 class="font-heading font-bold text-lg text-ink">Matrículas y Alumnos</h2>
                </div>
                <span class="font-body text-sm text-ink/60">Registro</span>
            </div>
            
            {% if inscripciones_alumnos %}
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead>
                            <tr class="border-b border-ink/20">
                                <th class="text-left py-3 px-4 font-body font-bold text-xs text-ink/70 uppercase tracking-wide">Estudiante</th>
                                <th class="text-left py-3 px-4 font-body font-bold text-xs text-ink/70 uppercase tracking-wide">Curso</th>
                                <th class="text-left py-3 px-4 font-body font-bold text-xs text-ink/70 uppercase tracking-wide">Instructor</th>
                                <th class="text-left py-3 px-4 font-body font-bold text-xs text-ink/70 uppercase tracking-wide">Estado</th>
                                <th class="text-right py-3 px-4 font-body font-bold text-xs text-ink/70 uppercase tracking-wide">Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for item in inscripciones_alumnos %}
                            <tr class="border-b border-ink/10 hover:bg-parchment/10 transition-colors">
                                <td class="py-3 px-4 font-body font-medium text-sm text-ink">{{ item.alumno.username }}</td>
                                <td class="py-3 px-4 font-body text-sm text-ink/70">
                                    {% if item.curso %}
                                        {{ item.curso.nombre }}
                                    {% else %}
                                        <em class="text-ink/40">Sin inscripción</em>
                                    {% endif %}
                                </td>
                                <td class="py-3 px-4 font-body text-sm text-ink/70">
                                    {% if item.profesor %}
                                        {{ item.profesor.username }}
                                    {% else %}
                                        <em class="text-ink/40">N/A</em>
                                    {% endif %}
                                </td>
                                <td class="py-3 px-4">
                                    {% if item.curso %}
                                        {% if item.pago_realizado %}
                                            <span class="inline-flex items-center gap-1.5 px-2.5 py-1 bg-green-100 border border-green-200 text-green-700 rounded-md font-body text-xs font-medium">
                                                <span class="w-1.5 h-1.5 rounded-full bg-green-500"></span>
                                                Pagado
                                            </span>
                                        {% else %}
                                            <span class="inline-flex items-center gap-1.5 px-2.5 py-1 bg-red-100 border border-red-200 text-red-700 rounded-md font-body text-xs font-medium">
                                                <span class="w-1.5 h-1.5 rounded-full bg-red-500"></span>
                                                Pendiente
                                            </span>
                                        {% endif %}
                                    {% else %}
                                        <span class="inline-flex items-center gap-1.5 px-2.5 py-1 bg-gray-100 border border-gray-200 text-gray-600 rounded-md font-body text-xs font-medium">
                                            <span class="w-1.5 h-1.5 rounded-full bg-gray-400"></span>
                                            Sin curso
                                        </span>
                                    {% endif %}
                                </td>
                                <td class="py-3 px-4 text-right">
                                    {% if item.inscripcion_id %}
                                        <a href="{{ url_for('admin.eliminar_inscripcion', inscripcion_id=item.inscripcion_id) }}"
                                           onclick="return confirm('¿Confirmar anulación de matrícula?')"
                                           class="text-ink/50 hover:text-yellow-600 hover:bg-yellow-50 p-1.5 rounded-md transition-colors" title="Anular">
                                            <span class="material-symbols-outlined text-base">cancel</span>
                                        </a>
                                    {% endif %}
                                    <a href="{{ url_for('admin.eliminar_alumno', alumno_id=item.alumno.id) }}"
                                       onclick="return confirm('⚠️ Esto eliminará al alumno y todos sus datos. ¿Continuar?')"
                                       class="text-ink/50 hover:text-red-600 hover:bg-red-50 p-1.5 rounded-md transition-colors" title="Eliminar">
                                        <span class="material-symbols-outlined text-base">delete</span>
                                    </a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <div class="py-10 text-center text-ink/50 font-body text-sm">
                    <span class="material-symbols-outlined text-3xl mb-2 block text-ink/20">groups</span>
                    No hay alumnos registrados
                </div>
            {% endif %}
        </div>
    </div>
</div>

<style>
    /* Scroll personalizado profesional */
    ::-webkit-scrollbar {
        width: 6px;
        height: 6px;
    }
    
    ::-webkit-scrollbar-track {
        background: rgba(44, 24, 16, 0.05);
        border-radius: 3px;
    }
    
    ::-webkit-scrollbar-thumb {
        background: rgba(44, 24, 16, 0.3);
        border-radius: 3px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
        background: rgba(44, 24, 16, 0.5);
    }
    
    /* Responsive */
    @media (max-width: 768px) {
        .grid.grid-cols-1.md\:grid-cols-2.lg\:grid-cols-4 {
            grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
        }
        
        table {
            font-size: 0.8rem;
        }
        
        th, td {
            padding: 6px 8px !important;
        }
        
        .px-8 {
            padding-left: 1rem !important;
            padding-right: 1rem !important;
        }
    }
    
    @media (max-width: 480px) {
        .grid.grid-cols-1.md\:grid-cols-2.lg\:grid-cols-4 {
            grid-template-columns: 1fr !important;
        }
        
        .text-2xl {
            font-size: 1.5rem !important;
        }
        
        .gap-6 {
            gap: 1rem !important;
        }
    }
</style>
{% endblock %}